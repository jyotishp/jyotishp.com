# Add SSH keys
mkdir -p ~/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC5GBGzEiNnp9OJJq0ilQrV6lHKpuATXkbFSkWH3XtLAHM48DDpk1hjtoQ1T4ncivMs1PjOdRXq+iy3JDuAXY/1uHq7XphGQPFfnbeHJ1UIgos2A1EAGMnic5d1ke7JRqDNe4XPvreUsExPp58wPTcO0j/2R8tyESo9YsB61TWHaEGOBbX/ocrFLRDhFcbqLJ6+aLvxD563GFq7eiAiyRGv2Kjq+8eNeGb3UxXkg7eoNf9JGx0qIg3ssfSbCDfMqFWdqdF8Y96GJCCISEBxvdCUiIeiryGvAGhd+K2Zr8AdZh/ntXExXIhc63UaYSDY1qwY4vEeoMnJf3MmvGn32P2JIf0ngf2OQv/SWEiuUKoy347ktm37C7nlaCDnpFR4sbVjtTWYRrxqG4vqJg7y7RI2phtcRBXLCd7//cq0AbLQ7/Zftt3olVyDNcTYJDj7y35M4onTG9423vX/WJNzzJVL4vUQyaKP4/3VJN/cYNXvbOehwPIgJxYdqglrDZG0YNJPDzgJ7ULgg3aOBZw8XYmD2FzlXBHZrWFc9oNEPKkqcsKvW9vNv2FR5zOy1dXkqcwQlv1FuCQgDaGAfesYwTzcZ5nlGbSjlnlRcLhKjqss9ZYRKC26F8ZtE8bid80I49ju0i7Nh2WXqR+Q4Q1xg/32/KYMhzLrRNx6E5e3TjyXdQ== root@dell13.iiit.ac.in" > ~/.ssh/authorized_keys
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDDpEC0N1NKsRPCuAFfRj0qXIGg3syZzPGYhokfkphvS3m9qR3g+pBsAN6WTo84xV8myZkAPwgWr5mni+rnJBf39WP5FNiJi3cuTmZKPtbg4vV8km8TMuR8gq/xeuYVZcKMkmqH7Fwt1Tq2wmJWmnlppQ1r6wISblujjizmZE3fFcZo6EEZa6SHIhqhXEM4gyES6EOt/wpmQdn+b4/+zp+WTI51EFSyRgAntC+UeOl+T8bsiQaQNbeP52/tud57J1nm+6pYMOGwKIq/JEeMhRQYH6FpCKL0rjrYrtI0Ibsk24vvh8AU4QZcGgObrrZwaAfjCLftmrXgMXjzF7TWEkv1D6ls973N/zQO+VHE9H1Hz1GXCwZlum7HJHn0TTP8khvvRBWg+7HJ05yeWfu4i+Zy8BJNXbYw8q0re+MpPAxrNnSInzVGde0tLFB3DL0pBB1zf/1aZY3Gk6AaU8OxOcZ43EMGXYTGGNCIDt5ibaiSDhKSdZwQFn2m1pLFi0IYKrzZiiVI4Bzuh5WfzHY/kyT4YvoK7fdF/FD3c0pfQcxguKiSAzFzxxlDBapZ13HrBytyFduLFl5gOZ9AWDmtG/7ivH8wTALBw6vxltPJ7HGuWPLnil9P94W21i5HaH67XDqDScw3BIox/v+eLY11gAp2TT7aWE3sLPL1c6H4SunRvQ== mrd@raftel" >> ~/.ssh/authorized_keys
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC96oE+qLHFxTmjyVPKmGIlB+92kCnPKMMSA4wy5+FFDvHTbshgV4UDV/j25WRn9i/I4foSHnYqExQe38eE9NtvvJp94phjaBKfgxB28b+YKJ49TsiFwejHSCf+ExO4TLzBGt6OILQ38j1AAEHWMTpObHVBmP6Jkrd2lYM8WXhQcMqSDzsB63gZQ76BBMiTMykhwS15XazbHXw8VIIQPMJ2sevbHKD0xY9sb/eJhucVsoUMAwsx6/26/xDZOvVQS1/fn/gf8nMYVN7fViN0/B/ZIJApfqsn/5KNfPo8MiktIn5zRqS0TuAta/ji2oY33RCiQvUjL8mZ6MwzMXk+3NdygCqJZoP+caiP9Dw78bV3ONbBcoxZehxhjhxQqU8hBSD28OtIoQY3wF4hjRQRoDpjmJMAwASIiJYQz/Hjt7pYRHJPY4Ych8TB702dISP47tyRXnDagjMtH5CvEOCZy5HaCEJvNMU/xGRcb/RbRvHG//ZIx+B3T8NkGbkkpB/rUp7SO8s+BcekL6yLbQAM37MqGYJkyb8/3H9AYi+YriQ84+B1S+bYZiZVpe96R5H1PlF2BrDe7lLFpTza6SVysplsHx5QhPpdTAGK7xPD7a29m6rmyOY/l/UoYCjniT1kcNlp9UQ4M0aM0IwQO3GC/uR/laFJIp/I221dRt3MLDvlSw== shivam@MDVLSHIVAMK" >> ~/.ssh/authorized_keys
echo "ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAEOJIHFwW2kGGw5k24K9PueiH4eHErgNKkjbYwg+75mfxpZPK25fQJyonFD2lyQgiX1X6ANdohxZSRHNUusqRzvqgDLTsnYFnkSXSgB30bvaWKb55c+M58/6rNqcATVpwOe7EOPMM2E6/eovvFBO0ZQHRPbiHo+24FuGaHOTd9RHiNrxA== Nair's Key" >> ~/.ssh/authorized_keys

unset http_proxy
unset https_proxy
curl -LO https://web.iiit.ac.in/~parth.kolekar/a.zsh

# Enabling cluster services at boot
systemctl enable flanneld kubelet kube-proxy

# Update Kubernetes client variables
sed -i 's/KUBE_MASTER="--master=http:\/\/127.0.0.1:8080"/KUBE_MASTER="--master=http:\/\/10.4.24.19:8080"/g' /etc/kubernetes/config
sed -i 's/KUBELET_ADDRESS="--address=127.0.0.1"/KUBELET_ADDRESS="--address=0.0.0.0"/g' /etc/kubernetes/kubelet
sed -i 's/KUBELET_API_SERVER="--api-servers=http:\/\/127.0.0.1:8080"/KUBELET_API_SERVER="--api-servers=http:\/\/10.4.24.19:8080"/g' /etc/kubernetes/kubelet

# Docker proxy
mkdir /etc/systemd/system/docker.service.d/
cat >/etc/systemd/system/docker.service.d/proxy.conf << EOF
[Service]
Environment=HTTP_PROXY=http://proxy.iiit.ac.in:8080/,HTTPS_PROXY=http://proxy.iiit.ac.in:8080/,NO_PROXY="localhost, 127.0.0.1, iiit.ac.in, .iiit.ac.in, iiit.net, .iiit.net, 172.16.0.0/12, 192.168.0.0/16, 10.0.0.0/8"
EOF
systemctl daemon-reload
systemctl restart docker.service

# Atomic proxy
echo "proxy=http://proxy.iiit.ac.in:8080" >> /etc/ostree/remotes.d/centos-atomic-host.conf

# Proxy for Yum Repos
sed -i '/gpgcheck=1/a proxy=http:\/\/proxy.iiit.ac.in:8080' /etc/yum.repos.d/CentOS-Base.repo

# Install requried tools
atomic host install git vim tmux zsh
export https_proxy=http://proxy.iiit.ac.in
curl -L https://jyotishp.ml/cdn/tmux.conf > .tmux.conf
echo ""
echo "After reboot run 'zsh ~/a.zsh'"
atomic host upgrade --reboot
